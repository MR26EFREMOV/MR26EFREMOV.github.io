<!doctype html>
<html>
<head lang="en">

    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Историко-культурное наследие Пермского края</title>
    <style>
        html, body, #viewDiv {
            padding: 0;
            margin: 0;
            height: 100%;
            width: 100%;
        }
    </style>

    <link rel="stylesheet" href="https://js.arcgis.com/4.14/esri/themes/light/main.css">
    <link rel="stylesheet" href="https://js.arcgis.com/4.14/esri/themes/dark-blue/main.css">
    <link rel="stylesheet" href="style.css">  <!-- Добавление CSS переопредления встроенных стилей-->
    <script src="https://js.arcgis.com/4.14/"></script>

    <script>
        require([
            "esri/Map",
            "esri/views/MapView",
            "esri/layers/FeatureLayer",
            "esri/widgets/Home",
            "esri/widgets/BasemapToggle",
            "esri/widgets/ScaleBar",
            "esri/widgets/DistanceMeasurement2D",
            "esri/widgets/AreaMeasurement2D",
            "esri/widgets/Legend",
            "esri/widgets/LayerList",
            "esri/widgets/Locate",

        ], function(Map, MapView, FeatureLayer, Home, BasemapToggle, ScaleBar, DistanceMeasurement2D, AreaMeasurement2D, Legend, LayerList, Locate) {
            var map = new Map({
                basemap: "osm"
            });

            var view = new MapView({
                container: "viewDiv",
                map: map,
                center: [57, 58],
                zoom: 6
            });
            // установка переключателя базовой карты
            var toggle = new BasemapToggle({
                // 2 - Set properties
                view: view, // view that provides access to the map's 'osm' basemap
                nextBasemap: "hybrid" // allows for toggling to the 'hybrid' basemap
            });
            // добавить масштабную линейку
            var scaleBar = new ScaleBar({
                view: view,
                unit: 'metric'
            });
            view.ui.add("topbar", "top-right");
            //добавить кнопки измерения площадей
            document
                .getElementById("distanceButton")
                .addEventListener("click", function() {
                    setActiveWidget(null);
                    if (!this.classList.contains("active")) {
                        setActiveWidget("distance");
                    } else {
                        setActiveButton(null);
                    }
                });

            document
                .getElementById("areaButton")
                .addEventListener("click", function() {
                    setActiveWidget(null);
                    if (!this.classList.contains("active")) {
                        setActiveWidget("area");
                    } else {
                        setActiveButton(null);
                    }
                });

            function setActiveWidget(type) {
                switch (type) {
                    case "distance":
                        activeWidget = new DistanceMeasurement2D({
                            view: view
                        });

                        // skip the initial 'new measurement' button
                        activeWidget.viewModel.newMeasurement();

                        view.ui.add(activeWidget, "top-right");
                        setActiveButton(document.getElementById("distanceButton"));
                        break;
                    case "area":
                        activeWidget = new AreaMeasurement2D({
                            view: view
                        });

                        // skip the initial 'new measurement' button
                        activeWidget.viewModel.newMeasurement();

                        view.ui.add(activeWidget, "top-right");
                        setActiveButton(document.getElementById("areaButton"));
                        break;
                    case null:
                        if (activeWidget) {
                            view.ui.remove(activeWidget);
                            activeWidget.destroy();
                            activeWidget = null;
                        }
                        break;
                }
            }

            function setActiveButton(selectedButton) {
                // focus the view to activate keyboard shortcuts for sketching
                view.focus();
                var elements = document.getElementsByClassName("active");
                for (var i = 0; i < elements.length; i++) {
                    elements[i].classList.remove("active");
                }
                if (selectedButton) {
                    selectedButton.classList.add("active");
                }
            }

            // Add widget to the top right corner of the view
            view.ui.add(toggle, "bottom-right");

            // добавление виджета для позиционирования
            var locateWidget = new Locate({
                view: view,   // Attaches the Locate button to the view
                // graphic: new Graphic({
                //     symbol: { type: "simple-marker" }  // overwrites the default symbol used for the
                //     // graphic placed at the location of the user when found
                // })
            });

            view.ui.add(locateWidget, "top-right");
            //БОЛЬШОЙ БЛОК ДОБАВЛЕНИЯ СЛОЁВ
            //Добавление слоя памятники истории 1
            const layer1 = new FeatureLayer({
                // URL to the service
                url: "http://maps.psu.ru:8080/arcgis/rest/services/history/history/MapServer/1",
                title: 'Объекты',
                outFields: ['*'],
                // popupTemplate: template,
            });
            //Добавление слоя Археологические памятники
            const layer2 = new FeatureLayer({
                // URL to the service
                url: "http://maps.psu.ru:8080/arcgis/rest/services/history/history/MapServer/2",
                title: 'Объекты',
                outFields: ['*'],
                // popupTemplate: template,
            });
            //Добавление слоя Памятники архитектуры
            const layer3 = new FeatureLayer({
                // URL to the service
                url: "http://maps.psu.ru:8080/arcgis/rest/services/history/history/MapServer/3",
                title: 'Объекты',
                outFields: ['*'],
                // popupTemplate: template,
            });
            //Добавление слоя ансамбли
            const layer4 = new FeatureLayer({
                // URL to the service
                url: "http://maps.psu.ru:8080/arcgis/rest/services/history/history/MapServer/4",
                title: 'Объекты',
                outFields: ['*'],
                // popupTemplate: template,
            });
            //Добавление слоя Объекты историко-культурного наследия
            const layer5 = new FeatureLayer({
                // URL to the service
                url: "http://maps.psu.ru:8080/arcgis/rest/services/history/history/MapServer/5",
                title: 'Объекты',
                outFields: ['*'],
                // popupTemplate: template,
            });
            //Добавление слоя Населенные пункты по ВВП
            const layer6 = new FeatureLayer({
                // URL to the service
                url: "http://maps.psu.ru:8080/arcgis/rest/services/history/history/MapServer/6",
                title: 'Объекты',
                outFields: ['*'],
                // popupTemplate: template,
            });
            // //Добавление слоя Волоки
            // const layer8 = new FeatureLayer({
            //     // URL to the service
            //     url: "http://maps.psu.ru:8080/arcgis/rest/services/history/history/MapServer/8",
            //     title: 'Объекты',
            //     outFields: ['*'],
            //     // popupTemplate: template,
            // });
            // //Добавление слоя Волоковые реки (линии)
            // const layer9 = new FeatureLayer({
            //     // URL to the service
            //     url: "http://maps.psu.ru:8080/arcgis/rest/services/history/history/MapServer/9",
            //     title: 'Объекты',
            //     outFields: ['*'],
            //     // popupTemplate: template,
            // });
            // //Добавление слоя Волоковые реки (полигоны)
            // const layer10 = new FeatureLayer({
            //     // URL to the service
            //     url: "http://maps.psu.ru:8080/arcgis/rest/services/history/history/MapServer/10",
            //     title: 'Объекты',
            //     outFields: ['*'],
            //     // popupTemplate: template,
            // });
            //Добавление слоя граница Пермского края
            const layer12 = new FeatureLayer({
                // URL to the service
                url: "http://maps.psu.ru:8080/arcgis/rest/services/history/history/MapServer/12",
                title: 'Объекты',
                outFields: ['*'],
                // popupTemplate: template,
            });
            //Добавление слоя границы муниципальных районов и округов
            const layer13 = new FeatureLayer({
                // URL to the service
                url: "http://maps.psu.ru:8080/arcgis/rest/services/history/history/MapServer/13",
                title: 'Объекты',
                outFields: ['*'],
                // popupTemplate: template,
            });
            //Добавление слоя границы городских и сельских поселений
            const layer14 = new FeatureLayer({
                // URL to the service
                url: "http://maps.psu.ru:8080/arcgis/rest/services/history/history/MapServer/14",
                title: 'Объекты',
                outFields: ['*'],
                // popupTemplate: template,
            });
            // Добавление слоя Области распространения карста
            // const layer15 = new FeatureLayer({
            //     // URL to the service
            //     url: "http://maps.psu.ru:8080/arcgis/rest/services/history/history/MapServer/15",
            //     title: 'Объекты',
            //     outFields: ['*'],
            //     // popupTemplate: template,
            // });
            // //Добавление слоя Инженерно-геологические формации коренных пород
            // const layer16 = new FeatureLayer({
            //     // URL to the service
            //     url: "http://maps.psu.ru:8080/arcgis/rest/services/history/history/MapServer/16",
            //     title: 'Объекты',
            //     outFields: ['*'],
            //     // popupTemplate: template,
            // });
            //Добавление слоя Почвенная карта
            // const layer17 = new FeatureLayer({
            //     // URL to the service
            //     url: "http://maps.psu.ru:8080/arcgis/rest/services/history/history/MapServer/17",
            //     title: 'Объекты',
            //     outFields: ['*'],
            //     // popupTemplate: template,
            // });
            map.add(layer12); //
            map.add(layer13); // это слои адм.ед
            map.add(layer14); //
            map.add(layer1);
            map.add(layer2);
            map.add(layer3);
            map.add(layer4);
            map.add(layer5);
            map.add(layer6);
            // map.add(layer8);
            // map.add(layer9);
            // map.add(layer10);

            // map.add(layer15);
            // map.add(layer16);
           // map.add(layer17);
            //добавление легенды
            var legend = new Legend({
                view: view,
                layerInfos: [{
                    layer: layer1,
                    title: "Легенды здесь нет"
                },{
                    layer: layer2,
                    title: "Легенды здесь нет"
                },
                    {
                        layer: layer3,
                        title: "Легенды здесь нет"
                    }
                ]
            });
            view.ui.add(legend, "bottom-right");
            //добавление слоев
            var layerList = new LayerList({
                view: view
            });
// Adds widget below other elements in the top left corner of the view
            view.ui.add(layerList, {
                position: "top-left"
            });
            //добавить кнопку домой
            var homeWidget = new Home({
                view: view
            });

            // adds the home widget to the top left corner of the MapView
            view.ui.add(homeWidget, "top-left");
            //
        });

    </script>
</head>
<body>
<h1 class="header">ИСТОРИКО-КУЛЬТУРНОЕ НАСЛЕДИЕ ПЕРМСКОГО КРАЯ</h1>
<div id="viewDiv"></div>
<div id="topbar">
    <button
            class="action-button esri-icon-measure-line"
            id="distanceButton"
            type="button"
            title="Measure distance between two or more points"
    ></button>
    <button
            class="action-button esri-icon-measure-area"
            id="areaButton"
            type="button"
            title="Measure area"
    ></button>
</div>
<script src="js.js"></script> <!-- Добавление CSS переопредления встроенного поведения-->
</body>
</html>